(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{7280:function(e,t,n){Promise.resolve().then(n.bind(n,7219)),Promise.resolve().then(n.bind(n,2948)),Promise.resolve().then(n.t.bind(n,6297,23)),Promise.resolve().then(n.t.bind(n,962,23)),Promise.resolve().then(n.t.bind(n,6408,23)),Promise.resolve().then(n.t.bind(n,4121,23))},3377:function(e,t,n){"use strict";n.d(t,{L:function(){return o},c:function(){return s}});var r=n(5474),a=n(666);function o(){return localStorage.getItem(a.px)}async function i(){return await (0,r.gw)(2e3),{code:"code",message:"Mock",result:{nickName:"Mock",token:"Mock"}}}async function s(e,t){if(a.M7)return await i();let n=await fetch("".concat(a.FH,"/member/login"),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({userName:e,password:t})});if(!n.ok)throw Error("HTTP error! status: ".concat(n.status));return await n.json()}},2948:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return P}});var r=n(9268),a=n(6006),o=n(984),i=n.n(o),s=n(5846),c=n.n(s),l=n(6008),u=n(9279),m=n.n(u),d=n(8683),g=n.n(d),p=n(7613),f=n.n(p);let h=[{href:"/member",title:"會員管理"},{href:"/restoration",title:"古蹟修復管理"},{href:"/landmark",title:"古蹟列表管理"},{href:"/store",title:"商家資訊管理"}],_=(0,a.memo)(e=>{let{href:t,children:n}=e,a=(0,l.usePathname)();return(0,r.jsx)(c(),{className:g()({[m().activate]:"".concat(f().basePath?f().basePath:"").concat(t)===a}),href:t,children:n})});_.displayName="NavItem";let v=(0,a.memo)(()=>(0,r.jsx)("div",{className:m().wrapper,children:h.map(e=>{let{href:t,title:n}=e;return(0,r.jsx)(_,{href:t,children:n},t)})}));v.displayName="Nav";var x=n(6624),k=n(6831),y=n(4161),M=n(7454),b=n(9153);let w=(0,a.memo)(()=>{let{authConfig:{loginState:e,username:t},logout:n}=(0,a.useContext)(x.V);return(0,r.jsxs)("div",{className:i().wrapper,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(M.Z,{src:"/images/logo.jpg",width:50,height:50,alt:"潮古蹟標誌"}),(0,r.jsx)("h3",{children:"潮古蹟"}),(0,r.jsx)(v,{})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{children:t}),(0,r.jsx)(k.Z,{loading:e===y.M.loggingOut,onClick:n,looks:b.L.dark,children:"登出"})]})]})});w.displayName="Navbar";var j=n(2082),S=n.n(j);let N=(0,a.memo)(e=>{let{children:t}=e,{authConfig:{loginState:n}}=(0,a.useContext)(x.V);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(w,{}),(0,r.jsx)("div",{className:S().wrapper,children:(n===y.M.true||n===y.M.loggingOut)&&t})]})});N.displayName="AdminLayout";var P=N},7219:function(e,t,n){"use strict";n.r(t);var r=n(9268),a=n(3099),o=n(3368),i=n(6624),s=n(4161),c=n(6006);let l=(0,c.memo)(e=>{let{loginPage:t,adminPage:n}=e,{authConfig:{loginState:l}}=(0,c.useContext)(i.V);switch(l){case s.M.none:return(0,r.jsx)(a.Z,{children:(0,r.jsx)(o.Z,{})});case s.M.validating:return(0,r.jsx)(o.Z,{expand:!0,children:n});case s.M.true:case s.M.validateError:case s.M.loggingOut:return n;case s.M.false:return t}});l.displayName="AuthRoute";let u=(0,c.memo)(e=>{let{loginPage:t,adminPage:n}=e;return(0,r.jsx)(i.H,{children:(0,r.jsx)(l,{loginPage:t,adminPage:n})})});u.displayName="AuthRouteWrapper",t.default=u},7454:function(e,t,n){"use strict";var r=n(9268),a=n(6394),o=n.n(a),i=n(6006),s=n(7613),c=n.n(s);let l=(0,i.memo)((0,i.forwardRef)((e,t)=>{let{src:n,...a}=e;return(0,r.jsx)(o(),{...a,ref:t,unoptimized:!0,src:"string"==typeof n&&n.startsWith("/")&&c().basePath?"".concat(c().basePath).concat(n):n})}));l.displayName="CustomImage",t.Z=l},6831:function(e,t,n){"use strict";var r=n(9268),a=n(6006),o=n(3368),i=n(1576),s=n.n(i),c=n(8683),l=n.n(c),u=n(9153);let m=(0,a.memo)(e=>{let{className:t,children:n,loading:a,disabled:i,htmlType:c,onClick:m,looks:d,icon:g}=e;return(0,r.jsxs)("button",{className:"close"===g?l()("bg-close bg-4 h-8 w-8 bg-center bg-no-repeat opacity-50",t):l()(s().button,{[s().primary]:d===u.L.primary,[s().danger]:d===u.L.danger,[s().dark]:d===u.L.dark},t),disabled:a||i,onClick:m,type:c,children:[a&&(0,r.jsx)(o.Z,{size:o.v.small})," ",n]})});m.displayName="Button",t.Z=m},3099:function(e,t,n){"use strict";var r=n(9268),a=n(6006),o=n(8414),i=n.n(o);let s=(0,a.memo)(e=>{let{children:t}=e;return(0,r.jsx)("div",{className:i().center,children:(0,r.jsx)("div",{children:t})})});s.displayName="Center",t.Z=s},3368:function(e,t,n){"use strict";n.d(t,{v:function(){return a}});var r,a,o=n(9268),i=n(6006),s=n(722),c=n.n(s),l=n(8683),u=n.n(l);(r=a||(a={})).small="small",r.medium="medium";let m=(0,i.memo)(e=>{let{spinning:t=!0,size:n=a.medium,expand:r=!1,children:i}=e;return t?(0,o.jsxs)("div",{className:u()(c().wrapper,{[c().expand]:r},{[c().small]:n===a.small,[c().medium]:n===a.medium}),children:[i,(0,o.jsx)("div",{className:u()(c().overlay,{[c().block]:!i}),children:(0,o.jsx)("div",{className:c().spinner})})]}):i});m.displayName="Spin",t.Z=m},6624:function(e,t,n){"use strict";n.d(t,{H:function(){return p},V:function(){return g}});var r=n(9268),a=n(3377),o=n(4161),i=n(2624),s=n(5474),c=n(666),l=n(6006);let u="loginState",m="username",d=()=>{let e=localStorage.getItem(u)||"",t=localStorage.getItem(m)||"",n=localStorage.getItem(c.px)||"";return e in o.M?{loginState:e,username:t,token:n}:{loginState:o.M.none,username:"",token:""}},g=(0,l.createContext)({authConfig:{loginState:o.M.none,username:"",token:""},login:async()=>{throw Error("AuthProvider not found")},logout:async()=>{throw Error("AuthProvider not found")}}),p=(0,l.memo)(e=>{let{children:t}=e,[n,p]=(0,l.useState)({loginState:o.M.none,username:"",token:""}),f=(0,l.useRef)(n);f.current=n;let h=(0,l.useCallback)(e=>{let{loginState:t,username:n,token:r}=e;p({loginState:t,username:n,token:r}),localStorage.setItem(u,t),localStorage.setItem(m,n),localStorage.setItem(c.px,r)},[]),_=(0,l.useCallback)(async function(e,t){let{logType:n=i.L.none}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(f.current.loginState===o.M.none)throw Error("Project starting");if(f.current.loginState===o.M.true||f.current.loginState===o.M.validating||f.current.loginState===o.M.validateError)throw Error("Already login");try{let r=await (0,a.c)(e,t);return h({loginState:o.M.true,username:r.result.nickName,token:r.result.token}),(0,s.cM)("log in success",n),!0}catch(e){return e instanceof Error?(0,s.cM)(e.message,n):(0,s.cM)(e,n),!1}},[h]),v=(0,l.useCallback)(async()=>(h({loginState:o.M.loggingOut,username:f.current.username,token:f.current.token}),await (0,s.gw)(2e3),h({loginState:o.M.false,username:"",token:""}),!0),[h]),x=(0,l.useMemo)(()=>({authConfig:n,login:_,logout:v}),[n,_,v]);return(0,l.useEffect)(()=>{let e=async()=>{let{loginState:e,username:t,token:n}=d();if(e===o.M.true||e===o.M.validateError){h({loginState:o.M.validating,username:t,token:n});try{h({loginState:o.M.true,username:t,token:n})}catch(e){e instanceof Error?(0,s.cM)(e.message,i.L.message):(0,s.cM)(e,i.L.message),h({loginState:o.M.validateError,username:t,token:n})}}else h({loginState:o.M.false,username:"",token:""})};e()},[h]),(0,r.jsx)(g.Provider,{value:x,children:t})});p.displayName="AuthProvider"},7613:function(e){"use strict";e.exports={output:"export",basePath:"/historic-site-portal-demo"}},4161:function(e,t,n){"use strict";var r,a;n.d(t,{M:function(){return r}}),(a=r||(r={})).none="none",a.validating="validating",a.validateError="validateError",a.true="true",a.false="false",a.loggingOut="loggingOut"},2624:function(e,t,n){"use strict";var r,a;n.d(t,{L:function(){return r}}),(a=r||(r={})).none="none",a.console="console",a.message="message"},9153:function(e,t,n){"use strict";var r,a;n.d(t,{L:function(){return r}}),(a=r||(r={})).primary="primary",a.dark="dark",a.danger="danger"},666:function(e,t,n){"use strict";n.d(t,{FH:function(){return r},M7:function(){return o},px:function(){return a}});let r="https://oldcity-backend.azurewebsites.net",a="token",o=!1},5474:function(e,t,n){"use strict";n.d(t,{cM:function(){return s},gw:function(){return i},rn:function(){return c},sG:function(){return l}});var r=n(2624),a=n(5326),o=n.n(a);let i=async e=>{await new Promise(t=>setTimeout(t,e))},s=(e,t)=>{switch(t){case r.L.none:break;case r.L.console:case r.L.message:console.log(e)}};function c(e){return e?o()(e).format("YYYY-MM-DD HH:mm:ss"):"--"}let l=(async()=>{}).constructor},4121:function(){},6408:function(){},2082:function(e){e.exports={wrapper:"AdminLayout_wrapper__1qyET"}},9279:function(e){e.exports={wrapper:"Nav_wrapper__inB0k",activate:"Nav_activate__8tx0l"}},984:function(e){e.exports={wrapper:"Header_wrapper___4abJ"}},6297:function(e){e.exports={wrapper:"Root_wrapper__oqOcq"}},1576:function(e){e.exports={button:"Button_button__kd7e2",primary:"Button_primary__Nhi6i",danger:"Button_danger__214td",dark:"Button_dark__Djc0e"}},8414:function(e){e.exports={center:"Center_center__ucmSV"}},722:function(e){e.exports={wrapper:"Spin_wrapper___n_bZ",expand:"Spin_expand__GPcNO",overlay:"Spin_overlay__oF_f6",block:"Spin_block__lUtsH",spinner:"Spin_spinner__jriaU",spin:"Spin_spin__j4j0X",small:"Spin_small__YbUV6",medium:"Spin_medium__fgQDT"}}},function(e){e.O(0,[550,720,56,253,488,744],function(){return e(e.s=7280)}),_N_E=e.O()}]);