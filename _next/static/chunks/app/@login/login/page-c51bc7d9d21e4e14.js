(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[334],{5808:function(e,t,n){Promise.resolve().then(n.bind(n,1174))},3377:function(e,t,n){"use strict";n.d(t,{L:function(){return o},c:function(){return s}});var r=n(956),a=n(2105);function o(){return localStorage.getItem(a.px)}async function i(){return await (0,r.gw)(2e3),{code:"code",message:"Mock",result:{nickName:"Mock",token:"Mock"}}}async function s(e,t){if(a.M7)return await i();let n=await fetch("".concat(a.FH,"/member/login"),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({userName:e,password:t})});if(!n.ok)throw Error("HTTP error! status: ".concat(n.status));return await n.json()}},1174:function(e,t,n){"use strict";n.r(t);var r=n(9268),a=n(6771),o=n(880),i=n.n(o),s=n(7454),l=n(6006),u=n(5493),c=n(6624),m=n(5528),d=n(1904),g=n(6917),f=n(2392);let p=Number(i().logoDiameter),h=(0,l.memo)(()=>{let{login:e}=(0,l.useContext)(c.V),[t,n]=(0,l.useState)(""),[o,h]=(0,l.useState)(""),v=(0,l.useCallback)(async()=>{await e(t,o,{logType:m.L.message})},[e,t,o]),{loading:S,run:_}=(0,d.Q)(v);return(0,r.jsx)(a.Z,{children:(0,r.jsxs)("div",{className:i().wrapper,children:[(0,r.jsx)(s.Z,{src:"TODO:",width:p,height:p,alt:"潮古蹟標誌"}),(0,r.jsx)("h1",{children:"潮古蹟管理後台"}),(0,r.jsxs)(f.Z,{layout:f.S.horizontal,onSubmit:_,children:[(0,r.jsx)(g.Z,{placeholder:"輸入帳號",onChange:n}),(0,r.jsx)(g.Z,{type:"password",placeholder:"輸入密碼",onChange:h}),(0,r.jsx)(u.Z,{loading:S,htmlType:"submit",children:"LOG IN"})]})]})})});h.displayName="LoginPage",t.default=h},5493:function(e,t,n){"use strict";var r=n(9268),a=n(6006),o=n(4308);let i=(0,a.memo)(e=>{let{children:t,loading:n,disabled:a,htmlType:i,onClick:s}=e;return(0,r.jsxs)("button",{disabled:n||a,onClick:s,type:i,children:[n&&(0,r.jsx)(o.Z,{size:o.v.small})," ",t]})});i.displayName="Button",t.Z=i},6771:function(e,t,n){"use strict";var r=n(9268),a=n(6006),o=n(780),i=n.n(o);let s=(0,a.memo)(e=>{let{children:t}=e;return(0,r.jsx)("div",{className:i().center,children:(0,r.jsx)("div",{children:t})})});s.displayName="Center",t.Z=s},7454:function(e,t,n){"use strict";var r=n(9268),a=n(6394),o=n.n(a),i=n(6006);let s=(0,i.memo)((0,i.forwardRef)((e,t)=>(0,r.jsx)(o(),{...e,ref:t,unoptimized:!0})));s.displayName="CustomImage",t.Z=s},2392:function(e,t,n){"use strict";n.d(t,{S:function(){return r}});var r,a=n(9268),o=n(6006),i=n(192),s=n.n(i),l=n(8683),u=n.n(l),c=n(956),m=n(5528);(r||(r={})).horizontal="horizontal";let d=(0,o.memo)(e=>{let{layout:t,onSubmit:n,children:i}=e,[l,d]=(0,o.useState)(!1);return(0,a.jsx)("form",{className:u()({[s().horizontal]:t===r.horizontal}),onSubmit:async e=>{if(e.preventDefault(),!l&&n){d(!0);try{n instanceof c.sG?await n():n()}catch(e){e instanceof Error?(0,c.cM)(e.message,m.L.console):(0,c.cM)(e,m.L.console)}finally{d(!1)}}},children:i})});d.displayName="Form",t.Z=d},6917:function(e,t,n){"use strict";var r=n(9268),a=n(6006);let o=(0,a.memo)(e=>{let{type:t,value:n,onChange:o,disabled:i,placeholder:s}=e,[l,u]=(0,a.useState)(n||"");return(0,r.jsx)("input",{type:t,value:l,onChange:e=>{let t=e.target.value;u(t),null==o||o(t)},disabled:i,placeholder:s})});o.displayName="Input",t.Z=o},4308:function(e,t,n){"use strict";n.d(t,{v:function(){return a}});var r,a,o=n(9268),i=n(6006),s=n(6753),l=n.n(s),u=n(8683),c=n.n(u);(r=a||(a={})).small="small",r.medium="medium";let m=(0,i.memo)(e=>{let{spinning:t=!0,size:n=a.medium,expand:r=!1,children:i}=e;return t?(0,o.jsxs)("div",{className:c()(l().wrapper,{[l().expand]:r},{[l().small]:n===a.small,[l().medium]:n===a.medium}),children:[i,(0,o.jsx)("div",{className:c()(l().overlay,{[l().block]:!i}),children:(0,o.jsx)("div",{className:l().spinner})})]}):i});m.displayName="Spin",t.Z=m},6624:function(e,t,n){"use strict";n.d(t,{H:function(){return f},V:function(){return g}});var r=n(9268),a=n(3377),o=n(7396),i=n(5528),s=n(956),l=n(2105),u=n(6006);let c="loginState",m="username",d=()=>{let e=localStorage.getItem(c)||"",t=localStorage.getItem(m)||"",n=localStorage.getItem(l.px)||"";return e in o.M?{loginState:e,username:t,token:n}:{loginState:o.M.none,username:"",token:""}},g=(0,u.createContext)({authConfig:{loginState:o.M.none,username:"",token:""},login:async()=>{throw Error("AuthProvider not found")},logout:async()=>{throw Error("AuthProvider not found")}}),f=(0,u.memo)(e=>{let{children:t}=e,[n,f]=(0,u.useState)({loginState:o.M.none,username:"",token:""}),p=(0,u.useRef)(n);p.current=n;let h=(0,u.useCallback)(e=>{let{loginState:t,username:n,token:r}=e;f({loginState:t,username:n,token:r}),localStorage.setItem(c,t),localStorage.setItem(m,n),localStorage.setItem(l.px,r)},[]),v=(0,u.useCallback)(async function(e,t){let{logType:n=i.L.none}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(p.current.loginState===o.M.none)throw Error("Project starting");if(p.current.loginState===o.M.true||p.current.loginState===o.M.validating||p.current.loginState===o.M.validateError)throw Error("Already login");try{let r=await (0,a.c)(e,t);return h({loginState:o.M.true,username:r.result.nickName,token:r.result.token}),(0,s.cM)("log in success",n),!0}catch(e){return e instanceof Error?(0,s.cM)(e.message,n):(0,s.cM)(e,n),!1}},[h]),S=(0,u.useCallback)(async()=>(h({loginState:o.M.loggingOut,username:p.current.username,token:p.current.token}),await (0,s.gw)(2e3),h({loginState:o.M.false,username:"",token:""}),!0),[h]),_=(0,u.useMemo)(()=>({authConfig:n,login:v,logout:S}),[n,v,S]);return(0,u.useEffect)(()=>{let e=async()=>{let{loginState:e,username:t,token:n}=d();if(e===o.M.true||e===o.M.validateError){h({loginState:o.M.validating,username:t,token:n});try{await (0,s.gw)(2e3),h({loginState:o.M.true,username:t,token:n})}catch(e){e instanceof Error?(0,s.cM)(e.message,i.L.message):(0,s.cM)(e,i.L.message),h({loginState:o.M.validateError,username:t,token:n})}}else h({loginState:o.M.false,username:"",token:""})};e()},[h]),(0,r.jsx)(g.Provider,{value:_,children:t})});f.displayName="AuthProvider"},1904:function(e,t,n){"use strict";n.d(t,{Q:function(){return a}});var r=n(6006);function a(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{manual:!0},n=(0,r.useRef)(t.manual),[a,o]=(0,r.useState)({loading:!1,data:void 0}),i=(0,r.useCallback)(async function(){for(var t=arguments.length,n=Array(t),r=0;r<t;r++)n[r]=arguments[r];o(e=>{let{data:t}=e;return{loading:!0,data:t}});let a=await e(...n);return o({loading:!1,data:a}),a},[e]),s=(0,r.useRef)(i);return(0,r.useEffect)(()=>{n.current||s.current(...[])},[]),(0,r.useMemo)(()=>({run:i,...a}),[i,a])}},7396:function(e,t,n){"use strict";var r,a;n.d(t,{M:function(){return r}}),(a=r||(r={})).none="none",a.validating="validating",a.validateError="validateError",a.true="true",a.false="false",a.loggingOut="loggingOut"},5528:function(e,t,n){"use strict";var r,a;n.d(t,{L:function(){return r}}),(a=r||(r={})).none="none",a.console="console",a.message="message"},2105:function(e,t,n){"use strict";n.d(t,{FH:function(){return r},M7:function(){return o},px:function(){return a}});let r="https://oldcity-backend.azurewebsites.net",a="token",o=!1},956:function(e,t,n){"use strict";n.d(t,{cM:function(){return o},gw:function(){return a},sG:function(){return i}});var r=n(5528);let a=async e=>{await new Promise(t=>setTimeout(t,e))},o=(e,t)=>{switch(t){case r.L.none:break;case r.L.console:case r.L.message:console.log(e)}},i=(async()=>{}).constructor},880:function(e){e.exports={logoDiameter:"50",wrapper:"page_wrapper__d8hW_"}},780:function(e){e.exports={center:"Center_center__OsABS"}},192:function(e){e.exports={horizontal:"Form_horizontal__tFVob"}},6753:function(e){e.exports={wrapper:"Spin_wrapper__jzwXV",expand:"Spin_expand__ESZgo",overlay:"Spin_overlay__7NIg6",block:"Spin_block__72E_5",spinner:"Spin_spinner__kje4B",spin:"Spin_spin__rqgOI",small:"Spin_small__nDrTw",medium:"Spin_medium__hCyU7"}}},function(e){e.O(0,[720,253,488,744],function(){return e(e.s=5808)}),_N_E=e.O()}]);