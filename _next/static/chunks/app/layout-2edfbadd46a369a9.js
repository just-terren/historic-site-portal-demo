(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{899:function(e,t,n){Promise.resolve().then(n.bind(n,438)),Promise.resolve().then(n.bind(n,7219)),Promise.resolve().then(n.t.bind(n,6408,23)),Promise.resolve().then(n.t.bind(n,1377,23))},3377:function(e,t,n){"use strict";n.d(t,{L:function(){return o},c:function(){return i}});var r=n(956),a=n(2105);function o(){return localStorage.getItem(a.px)}async function s(){return await (0,r.gw)(2e3),{code:"code",message:"Mock",result:{nickName:"Mock",token:"Mock"}}}async function i(e,t){if(a.M7)return await s();let n=await fetch("".concat(a.FH,"/member/login"),{method:"POST",mode:"cors",headers:{"Content-Type":"application/json"},body:JSON.stringify({userName:e,password:t})});if(!n.ok)throw Error("HTTP error! status: ".concat(n.status));return await n.json()}},438:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return C}});var r=n(9268),a=n(6006),o=n(9906),s=n.n(o),i=n(5846),u=n.n(i),c=n(6008),l=n(5499),m=n.n(l),d=n(8683),g=n.n(d),f=n(7613),p=n.n(f);let h=[{href:"/member",title:"會員管理"},{href:"/restoration",title:"古蹟修復管理"}],v=(0,a.memo)(e=>{let{href:t,children:n}=e,a=(0,c.usePathname)();return(0,r.jsx)(u(),{className:g()({[m().activate]:"".concat(p().basePath?p().basePath:"").concat(t)===a}),href:t,children:n})});v.displayName="NavItem";let _=(0,a.memo)(()=>(0,r.jsx)("div",{className:m().wrapper,children:h.map(e=>{let{href:t,title:n}=e;return(0,r.jsx)(v,{href:t,children:n},t)})}));_.displayName="Nav";var x=n(6624),k=n(5493),M=n(7396),w=n(7454),y=n(4507);let S=(0,a.memo)(()=>{let{authConfig:{loginState:e,username:t},logout:n}=(0,a.useContext)(x.V);return(0,r.jsxs)("div",{className:s().wrapper,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)(w.Z,{src:"/logo.jpg",width:50,height:50,alt:"潮古蹟標誌"}),(0,r.jsx)("h3",{children:"潮古蹟"}),(0,r.jsx)(_,{})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{children:t}),(0,r.jsx)(k.Z,{loading:e===M.M.loggingOut,onClick:n,looks:y.L.dark,children:"登出"})]})]})});S.displayName="Navbar";var j=n(2082),N=n.n(j);let b=(0,a.memo)(e=>{let{children:t}=e,{authConfig:{loginState:n}}=(0,a.useContext)(x.V);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(S,{}),(0,r.jsx)("div",{className:N().wrapper,children:(n===M.M.true||n===M.M.loggingOut)&&t})]})});b.displayName="AdminLayout";var C=b},7219:function(e,t,n){"use strict";n.r(t);var r=n(9268),a=n(6771),o=n(4308),s=n(6624),i=n(7396),u=n(6006);let c=(0,u.memo)(e=>{let{loginPage:t,adminPage:n}=e,{authConfig:{loginState:c}}=(0,u.useContext)(s.V);switch(c){case i.M.none:return(0,r.jsx)(a.Z,{children:(0,r.jsx)(o.Z,{})});case i.M.validating:return(0,r.jsx)(o.Z,{expand:!0,children:n});case i.M.true:case i.M.validateError:case i.M.loggingOut:return n;case i.M.false:return t}});c.displayName="AuthRoute";let l=(0,u.memo)(e=>{let{loginPage:t,adminPage:n}=e;return(0,r.jsx)(s.H,{children:(0,r.jsx)(c,{loginPage:t,adminPage:n})})});l.displayName="AuthRouteWrapper",t.default=l},5493:function(e,t,n){"use strict";var r=n(9268),a=n(6006),o=n(4308),s=n(6361),i=n.n(s),u=n(8683),c=n.n(u),l=n(4507);let m=(0,a.memo)(e=>{let{children:t,loading:n,disabled:a,htmlType:s,onClick:u,looks:m}=e;return(0,r.jsxs)("button",{className:c()(i().button,{[i().dark]:m===l.L.dark}),disabled:n||a,onClick:u,type:s,children:[n&&(0,r.jsx)(o.Z,{size:o.v.small})," ",t]})});m.displayName="Button",t.Z=m},6771:function(e,t,n){"use strict";var r=n(9268),a=n(6006),o=n(780),s=n.n(o);let i=(0,a.memo)(e=>{let{children:t}=e;return(0,r.jsx)("div",{className:s().center,children:(0,r.jsx)("div",{children:t})})});i.displayName="Center",t.Z=i},7454:function(e,t,n){"use strict";var r=n(9268),a=n(6394),o=n.n(a),s=n(6006),i=n(7613),u=n.n(i);let c=(0,s.memo)((0,s.forwardRef)((e,t)=>{let{src:n,...a}=e;return(0,r.jsx)(o(),{...a,ref:t,unoptimized:!0,src:"string"==typeof n&&n.startsWith("/")&&u().basePath?"".concat(u().basePath).concat(n):n})}));c.displayName="CustomImage",t.Z=c},4308:function(e,t,n){"use strict";n.d(t,{v:function(){return a}});var r,a,o=n(9268),s=n(6006),i=n(6753),u=n.n(i),c=n(8683),l=n.n(c);(r=a||(a={})).small="small",r.medium="medium";let m=(0,s.memo)(e=>{let{spinning:t=!0,size:n=a.medium,expand:r=!1,children:s}=e;return t?(0,o.jsxs)("div",{className:l()(u().wrapper,{[u().expand]:r},{[u().small]:n===a.small,[u().medium]:n===a.medium}),children:[s,(0,o.jsx)("div",{className:l()(u().overlay,{[u().block]:!s}),children:(0,o.jsx)("div",{className:u().spinner})})]}):s});m.displayName="Spin",t.Z=m},6624:function(e,t,n){"use strict";n.d(t,{H:function(){return h},V:function(){return p}});var r=n(9268),a=n(3377),o=n(7396),s=n(5528),i=n(956),u=n(2105),c=n(1857),l=n(6008),m=n(6006);let d="loginState",g="username",f=()=>{let e=localStorage.getItem(d)||"",t=localStorage.getItem(g)||"",n=localStorage.getItem(u.px)||"";return e in o.M?{loginState:e,username:t,token:n}:{loginState:o.M.none,username:"",token:""}},p=(0,m.createContext)({authConfig:{loginState:o.M.none,username:"",token:""},login:async()=>{throw Error("AuthProvider not found")},logout:async()=>{throw Error("AuthProvider not found")}}),h=(0,m.memo)(e=>{let{children:t}=e,[n,h]=(0,m.useState)({loginState:o.M.none,username:"",token:""}),v=(0,m.useRef)(n);v.current=n;let _=(0,m.useCallback)(e=>{let{loginState:t,username:n,token:r}=e;h({loginState:t,username:n,token:r}),localStorage.setItem(d,t),localStorage.setItem(g,n),localStorage.setItem(u.px,r)},[]),x=(0,m.useCallback)(async function(e,t){let{logType:n=s.L.none}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(v.current.loginState===o.M.none)throw Error("Project starting");if(v.current.loginState===o.M.true||v.current.loginState===o.M.validating||v.current.loginState===o.M.validateError)throw Error("Already login");try{let r=await (0,a.c)(e,t);return _({loginState:o.M.true,username:r.result.nickName,token:r.result.token}),(0,i.cM)("log in success",n),!0}catch(e){return e instanceof Error?(0,i.cM)(e.message,n):(0,i.cM)(e,n),!1}},[_]),k=(0,l.useRouter)(),M=(0,m.useCallback)(async()=>(_({loginState:o.M.loggingOut,username:v.current.username,token:v.current.token}),await (0,i.gw)(2e3),_({loginState:o.M.false,username:"",token:""}),k.push(c.Qv),!0),[_,k]),w=(0,m.useMemo)(()=>({authConfig:n,login:x,logout:M}),[n,x,M]);return(0,m.useEffect)(()=>{let e=async()=>{let{loginState:e,username:t,token:n}=f();if(e===o.M.true||e===o.M.validateError){_({loginState:o.M.validating,username:t,token:n});try{_({loginState:o.M.true,username:t,token:n})}catch(e){e instanceof Error?(0,i.cM)(e.message,s.L.message):(0,i.cM)(e,s.L.message),_({loginState:o.M.validateError,username:t,token:n})}}else _({loginState:o.M.false,username:"",token:""})};e()},[_]),(0,r.jsx)(p.Provider,{value:w,children:t})});h.displayName="AuthProvider"},7613:function(e){"use strict";e.exports={output:"export",basePath:"/historic-site-portal-demo"}},7396:function(e,t,n){"use strict";var r,a;n.d(t,{M:function(){return r}}),(a=r||(r={})).none="none",a.validating="validating",a.validateError="validateError",a.true="true",a.false="false",a.loggingOut="loggingOut"},5528:function(e,t,n){"use strict";var r,a;n.d(t,{L:function(){return r}}),(a=r||(r={})).none="none",a.console="console",a.message="message"},4507:function(e,t,n){"use strict";var r;n.d(t,{L:function(){return r}}),(r||(r={})).dark="dark"},2105:function(e,t,n){"use strict";n.d(t,{FH:function(){return r},M7:function(){return o},px:function(){return a}});let r="https://oldcity-backend.azurewebsites.net",a="token",o=!1},956:function(e,t,n){"use strict";n.d(t,{cM:function(){return o},gw:function(){return a},sG:function(){return s}});var r=n(5528);let a=async e=>{await new Promise(t=>setTimeout(t,e))},o=(e,t)=>{switch(t){case r.L.none:break;case r.L.console:case r.L.message:console.log(e)}},s=(async()=>{}).constructor},1857:function(e,t,n){"use strict";n.d(t,{$x:function(){return o},Qv:function(){return s},qz:function(){return r},sM:function(){return a}});let r="redirect",a="/",o="/member",s="/login"},6408:function(){},2082:function(e){e.exports={wrapper:"AdminLayout_wrapper__1qyET"}},5499:function(e){e.exports={wrapper:"Nav_wrapper__Gi484",activate:"Nav_activate__dyq9V"}},9906:function(e){e.exports={wrapper:"Navbar_wrapper__IjV9s"}},6361:function(e){e.exports={button:"Button_button__9tXVr",dark:"Button_dark__TmCnt"}},780:function(e){e.exports={center:"Center_center__OsABS"}},6753:function(e){e.exports={wrapper:"Spin_wrapper__jzwXV",expand:"Spin_expand__ESZgo",overlay:"Spin_overlay__7NIg6",block:"Spin_block__72E_5",spinner:"Spin_spinner__kje4B",spin:"Spin_spin__rqgOI",small:"Spin_small__nDrTw",medium:"Spin_medium__hCyU7"}}},function(e){e.O(0,[720,98,253,488,744],function(){return e(e.s=899)}),_N_E=e.O()}]);